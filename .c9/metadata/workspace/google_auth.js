{"filter":false,"title":"google_auth.js","tooltip":"/google_auth.js","undoManager":{"mark":1,"position":1,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":0,"column":33}},"text":"var express = require('express'),"},{"action":"insertText","range":{"start":{"row":0,"column":33},"end":{"row":1,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":1,"column":0},"end":{"row":58,"column":0}},"lines":["    bodyParser = require('body-parser'),","    cookieParser = require('cookie-parser'),","    expressSession = require('express-session'),","    passport = require('passport'),","    GoogleStrategy = require('passport-google').Strategy;","passport.serializeUser(function(user, done) {","  done(null, user);","});","passport.deserializeUser(function(obj, done) {","  done(null, obj);","});","passport.use(new GoogleStrategy({","    returnURL: 'http://localhost/auth/google/return',","    realm: 'http://localhost/'","  },","  function(identifier, profile, done) {","    process.nextTick(function () {","      profile.identifier = identifier;","      return done(null, profile);","    });","  }","));","var app = express();","app.engine('.html', require('ejs').__express);","app.set('views', __dirname + '/views');","app.set('view engine', 'html');","app.use(bodyParser.urlencoded({ extended: true }));","app.use(bodyParser.json());","app.use(cookieParser());","app.use(expressSession({ secret: 'SECRET' }));","app.use(passport.initialize());","app.use(passport.session());","app.use(express.static(__dirname + '/static'));","app.get('/login', function(req, res){","  if(req.isAuthenticated()){","    res.redirect('/info');","  } else{","    res.render('login', { user: req.user });","  }","});","app.get('/auth/google', ","  passport.authenticate('google'));","app.get('/auth/google/return', ","  passport.authenticate('google', { ","    successRedirect: '/info', ","    failureRedirect: '/login' }));","app.get('/logout', function(req, res){","  req.logout();","  res.redirect('/login');","});","app.get('/info', function(req, res){","  if(req.isAuthenticated()){","    res.render('info', { user: req.user });","  } else {","    res.redirect('/login');","  }","});"]},{"action":"insertText","range":{"start":{"row":58,"column":0},"end":{"row":58,"column":15}},"text":"app.listen(80);"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":7,"column":2},"end":{"row":7,"column":4}},"text":"  "},{"action":"insertText","range":{"start":{"row":10,"column":2},"end":{"row":10,"column":4}},"text":"  "},{"action":"insertText","range":{"start":{"row":13,"column":4},"end":{"row":13,"column":8}},"text":"    "},{"action":"insertText","range":{"start":{"row":14,"column":4},"end":{"row":14,"column":8}},"text":"    "},{"action":"insertText","range":{"start":{"row":15,"column":0},"end":{"row":15,"column":1}},"text":" "},{"action":"insertText","range":{"start":{"row":15,"column":3},"end":{"row":15,"column":4}},"text":" "},{"action":"insertText","range":{"start":{"row":16,"column":0},"end":{"row":16,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":17,"column":4},"end":{"row":17,"column":8}},"text":"    "},{"action":"removeText","range":{"start":{"row":17,"column":33},"end":{"row":17,"column":34}},"text":" "},{"action":"insertText","range":{"start":{"row":18,"column":0},"end":{"row":18,"column":1}},"text":" "},{"action":"insertText","range":{"start":{"row":18,"column":7},"end":{"row":18,"column":12}},"text":"     "},{"action":"insertText","range":{"start":{"row":19,"column":0},"end":{"row":19,"column":4}},"text":"    "},{"action":"insertText","range":{"start":{"row":19,"column":10},"end":{"row":19,"column":12}},"text":"  "},{"action":"insertText","range":{"start":{"row":20,"column":4},"end":{"row":20,"column":8}},"text":"    "},{"action":"insertText","range":{"start":{"row":21,"column":0},"end":{"row":21,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":27,"column":31},"end":{"row":28,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":28,"column":0},"end":{"row":28,"column":3}},"text":"   "},{"action":"removeText","range":{"start":{"row":28,"column":18},"end":{"row":28,"column":19}},"text":" "},{"action":"insertText","range":{"start":{"row":28,"column":18},"end":{"row":29,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":32,"column":24},"end":{"row":33,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":33,"column":0},"end":{"row":33,"column":3}},"text":"   "},{"action":"removeText","range":{"start":{"row":33,"column":20},"end":{"row":33,"column":21}},"text":" "},{"action":"insertText","range":{"start":{"row":33,"column":20},"end":{"row":34,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":38,"column":36},"end":{"row":38,"column":37}},"text":" "},{"action":"insertText","range":{"start":{"row":39,"column":0},"end":{"row":39,"column":1}},"text":" "},{"action":"insertText","range":{"start":{"row":39,"column":3},"end":{"row":39,"column":4}},"text":" "},{"action":"insertText","range":{"start":{"row":39,"column":6},"end":{"row":39,"column":7}},"text":" "},{"action":"insertText","range":{"start":{"row":39,"column":30},"end":{"row":39,"column":31}},"text":" "},{"action":"insertText","range":{"start":{"row":40,"column":0},"end":{"row":40,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":40,"column":6},"end":{"row":40,"column":8}},"text":"  "},{"action":"insertText","range":{"start":{"row":41,"column":2},"end":{"row":41,"column":4}},"text":"  "},{"action":"insertText","range":{"start":{"row":41,"column":5},"end":{"row":42,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":42,"column":0},"end":{"row":42,"column":3}},"text":"   "},{"action":"insertText","range":{"start":{"row":42,"column":8},"end":{"row":42,"column":9}},"text":" "},{"action":"insertText","range":{"start":{"row":43,"column":0},"end":{"row":43,"column":4}},"text":"    "},{"action":"insertText","range":{"start":{"row":43,"column":29},"end":{"row":44,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":44,"column":0},"end":{"row":44,"column":11}},"text":"           "},{"action":"insertText","range":{"start":{"row":44,"column":26},"end":{"row":45,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":45,"column":0},"end":{"row":45,"column":7}},"text":"       "},{"action":"insertText","range":{"start":{"row":46,"column":0},"end":{"row":46,"column":1}},"text":" "},{"action":"insertText","range":{"start":{"row":46,"column":3},"end":{"row":46,"column":4}},"text":" "},{"action":"insertText","range":{"start":{"row":48,"column":23},"end":{"row":49,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":49,"column":0},"end":{"row":49,"column":1}},"text":" "},{"action":"removeText","range":{"start":{"row":49,"column":2},"end":{"row":50,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":50,"column":30},"end":{"row":51,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":51,"column":0},"end":{"row":51,"column":1}},"text":" "},{"action":"removeText","range":{"start":{"row":51,"column":2},"end":{"row":52,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":51,"column":37},"end":{"row":52,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":52,"column":0},"end":{"row":52,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":52,"column":3},"end":{"row":53,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":52,"column":3},"end":{"row":52,"column":4}},"text":" "},{"action":"removeText","range":{"start":{"row":52,"column":33},"end":{"row":52,"column":34}},"text":" "},{"action":"insertText","range":{"start":{"row":53,"column":4},"end":{"row":53,"column":8}},"text":"    "},{"action":"insertText","range":{"start":{"row":53,"column":33},"end":{"row":54,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":54,"column":0},"end":{"row":54,"column":3}},"text":"   "},{"action":"insertText","range":{"start":{"row":55,"column":37},"end":{"row":55,"column":38}},"text":" "},{"action":"insertText","range":{"start":{"row":56,"column":0},"end":{"row":56,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":57,"column":2},"end":{"row":57,"column":4}},"text":"  "},{"action":"insertText","range":{"start":{"row":59,"column":35},"end":{"row":59,"column":36}},"text":" "},{"action":"insertText","range":{"start":{"row":60,"column":2},"end":{"row":60,"column":4}},"text":"  "},{"action":"insertText","range":{"start":{"row":60,"column":6},"end":{"row":60,"column":7}},"text":" "},{"action":"insertText","range":{"start":{"row":60,"column":30},"end":{"row":60,"column":31}},"text":" "},{"action":"insertText","range":{"start":{"row":61,"column":0},"end":{"row":61,"column":3}},"text":"   "},{"action":"insertText","range":{"start":{"row":61,"column":7},"end":{"row":61,"column":8}},"text":" "},{"action":"insertText","range":{"start":{"row":61,"column":28},"end":{"row":62,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":62,"column":0},"end":{"row":62,"column":11}},"text":"           "},{"action":"insertText","range":{"start":{"row":62,"column":26},"end":{"row":63,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":63,"column":0},"end":{"row":63,"column":7}},"text":"       "},{"action":"insertText","range":{"start":{"row":64,"column":0},"end":{"row":64,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":64,"column":5},"end":{"row":65,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":65,"column":0},"end":{"row":65,"column":3}},"text":"   "},{"action":"insertText","range":{"start":{"row":66,"column":0},"end":{"row":66,"column":4}},"text":"    "},{"action":"insertText","range":{"start":{"row":67,"column":0},"end":{"row":67,"column":2}},"text":"  "}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":69,"column":15},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1415817332159,"hash":"4f9375d59b06f4f35c6d8d9a8e1122832da2f9b9"}